<Window x:Class="TechKingPOS.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TechKing POS"
        WindowState="Maximized"
        Background="#1E3A8A">

<Window.Resources>

    <!-- ================= TASK MENU BUTTON STYLE ================= -->
    <Style x:Key="TaskMenuButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="#FFF8E7"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="Padding" Value="14,0"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="Cursor" Value="Hand"/>
        <Setter Property="Margin" Value="0,4,0,4"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="6">
                        <ContentPresenter VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#F3EAD3"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="Background" Value="#EADFBF"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ================= PROFESSIONAL BRANCH COMBOBOX STYLE ================= -->
    <Style x:Key="BranchComboBoxStyle" TargetType="ComboBox">
    <Setter Property="Foreground" Value="White"/>
    <Setter Property="Background" Value="#111827"/> <!-- Taskbar color -->
    <Setter Property="Padding" Value="4,2"/>
    <Setter Property="FontWeight" Value="SemiBold"/>
    <Setter Property="Width" Value="140"/>
    <Setter Property="HorizontalContentAlignment" Value="Left"/>
    <Setter Property="BorderBrush" Value="#374151"/>
    <Setter Property="BorderThickness" Value="1"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="ComboBox">
                <Grid>
                    <!-- Closed box -->
                    <Border Name="Border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4">
                        <DockPanel>
                            <ContentPresenter Name="ContentSite"
                                              Margin="6,2,25,2"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"/>
                            <ToggleButton Name="ToggleButton"
                                          DockPanel.Dock="Right"
                                          Focusable="False"
                                          IsChecked="{Binding Path=IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                                          ClickMode="Press"
                                          Background="Transparent"
                                          BorderThickness="0">
                                <Path HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      Data="M 0 0 L 4 4 L 8 0 Z"
                                      Fill="White"/>
                            </ToggleButton>
                        </DockPanel>
                    </Border>

                    <!-- Dropdown popup -->
                    <Popup Name="Popup"
                           Placement="Bottom"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           AllowsTransparency="True"
                           Focusable="False"
                           PopupAnimation="Slide">
                        <Border Name="DropDownBorder"
                                Background="#111827"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                SnapsToDevicePixels="True">
                            <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True"
                                            KeyboardNavigation.DirectionalNavigation="Contained"/>
                            </ScrollViewer>
                        </Border>
                    </Popup>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter TargetName="Border" Property="Background" Value="#888"/>
                        <Setter Property="Foreground" Value="#AAA"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>

    <!-- ComboBoxItem style -->
    <Setter Property="ItemContainerStyle">
        <Setter.Value>
            <Style TargetType="ComboBoxItem">
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="Background" Value="#111827"/>
                <Setter Property="Padding" Value="4"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#1D4ED8"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Trigger>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="#2563EB"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Setter.Value>
    </Setter>
</Style>


</Window.Resources>



    <Grid PreviewMouseDown="RootGrid_MouseDown">

        <!-- ================= DESKTOP ================= -->
        <Canvas x:Name="Desktop"
                Background="#1E3A8A"/>

                    <!-- ================= TOP TASKBAR (OVERLAY) ================= -->
            <Border Height="42"
                    Background="#111827"
                    VerticalAlignment="Top"
                    Panel.ZIndex="10">

                <Grid MouseDown="MainGrid_MouseDown">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- LEFT SIDE: EXISTING TASK BAR -->
                    <StackPanel x:Name="TaskBar"
                                Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="10,0"/>

            <!-- RIGHT SIDE: USER PROFILE -->
            <Grid Grid.Column="1"
                VerticalAlignment="Center"
                Margin="0,0,12,0">

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,12,0">
                    <!-- Branch selector for Admin -->
                    <ComboBox x:Name="BranchSelector"
                            Style="{StaticResource BranchComboBoxStyle}"
                            SelectedValuePath="Id"
                            DisplayMemberPath="Name"
                            SelectionChanged="BranchSelector_SelectionChanged"/>
                    
                    <!-- USER BUTTON -->
                    <Border x:Name="UserButtonBorder"
                            Background="Transparent"
                            Cursor="Hand"
                            VerticalAlignment="Center"
                            MouseLeftButtonUp="ToggleUserMenu">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="👤"
                                    FontSize="14"
                                    Foreground="White"
                                    Margin="12,0,6,0"/> <!-- added spacing before branch -->
                            <TextBlock x:Name="UserNameText"
                                    Text="John"
                                    Foreground="White"
                                    FontWeight="SemiBold"/>
                            <TextBlock Text=" ▼"
                                    Foreground="White"
                                    FontSize="10"
                                    Margin="4,0,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- DROPDOWN POPUP -->
                    <Popup x:Name="UserMenu"
                        Placement="Bottom"
                        PlacementTarget="{Binding ElementName=UserButtonBorder}"
                        StaysOpen="False"
                        AllowsTransparency="True"
                        PopupAnimation="Slide">
                        <Border Background="White"
                                CornerRadius="6"
                                Width="160"
                                BorderBrush="#E5E7EB"
                                BorderThickness="1"
                                Padding="4">
                            <StackPanel>
                                <Button Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalContentAlignment="Left"
                                        Padding="10"
                                        Click="EditProfile_Click">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="✏️" Margin="0,0,8,0"/>
                                        <TextBlock Text="Edit Profile"/>
                                    </StackPanel>
                                </Button>
                                <Separator/>
                                <Button Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalContentAlignment="Left"
                                        Padding="10"
                                        Click="Logout_Click">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="⏻" Margin="0,0,8,0"/>
                                        <TextBlock Text="Logout"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Border>
                    </Popup>
                </StackPanel>

                </Grid>


                </Grid>
            </Border>


        <!-- ================= FLOATING TASK BUTTON ================= -->
<Grid HorizontalAlignment="Left"
      VerticalAlignment="Bottom"
      Margin="20"
      Panel.ZIndex="20">

    <!-- FLOATING BUTTON -->
    <Button x:Name="TaskToggleButton"
            Content="☰"
            Width="56"
            Height="70"
            FontSize="26"
            FontWeight="SemiBold"
            Background="#111827"
            Foreground="White"
            BorderThickness="0"
            Cursor="Hand"
            Click="ToggleTaskMenu"
            MouseEnter="TaskButton_MouseEnter"
            MouseLeave="TaskButton_MouseLeave"/>

    <!-- HOVER LABEL -->
    <Popup x:Name="TaskButtonHint"
           Placement="Right"
           PlacementTarget="{Binding ElementName=TaskToggleButton}"
           AllowsTransparency="True"
           IsHitTestVisible="False">

        <Border Background="#111827"
                Padding="10,6"
                CornerRadius="6"
                Opacity="0.95">

            <TextBlock Text="Start"
                       Foreground="White"
                       FontSize="13"/>
        </Border>
    </Popup>

</Grid>


 <!-- ================= TASK MENU ================= -->
<Border x:Name="TaskMenu"
        Width="220"
        Background="White"
        CornerRadius="10"
        Padding="10"
        HorizontalAlignment="Left"
        VerticalAlignment="Bottom"
        Margin="20,0,0,90"
        Visibility="Collapsed"
        Panel.ZIndex="30">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TITLE -->
        <TextBlock Text="Windows"
                   FontWeight="SemiBold"
                   Margin="4,0,0,10"/>

        <!-- BUTTONS -->
        <StackPanel Grid.Row="1">

    <Button x:Name="btnSales"
            Content="Sales"
            Click="OpenSales"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnItems"
            Content="Add Items"
            Click="OpenItems"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnStock"
            Content="Manage Stock"
            Click="OpenStock"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnCredit"
            Content="Credit Manager"
            Click="OpenCredit"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnReports"
            Content="Reports"
            Click="OpenReports"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnWorkers"
            Content="Workers"
            Click="OpenWorkers"
            Style="{StaticResource TaskMenuButtonStyle}"/>

    <Button x:Name="btnSettings"
            Content="Settings"
            Click="OpenSettings"
            Style="{StaticResource TaskMenuButtonStyle}"/>

</StackPanel>

    </Grid>
</Border>
    </Grid>
</Window>
